"use strict";(()=>{var e={};e.id=358,e.ids=[358],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8796:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{GET:()=>u,OPTIONS:()=>c,revalidate:()=>p});var o=r(7092),a=r(5932),n=r(4147),i=r(7856);let l="https://storage.yandexcloud.net/screen-shared",p=300;async function u(e){try{let{searchParams:t}=new URL(e.url),r=t.get("path"),s=t.get("action");if(!r)return i.NextResponse.json({error:"Missing path parameter"},{status:400});if("list"===s){let e=`${l}/?list-type=2&prefix=${encodeURIComponent(r)}`;console.log(`[S3 Proxy] Listing files: ${e}`);let t=await fetch(e,{method:"GET",headers:{Accept:"application/xml","User-Agent":"Coefly-App/1.0"},cache:"no-store"});if(!t.ok)return console.error(`[S3 Proxy] List failed: ${t.status} ${t.statusText}`),i.NextResponse.json({error:`S3 request failed: ${t.statusText}`},{status:t.status});let s=await t.text();return new i.NextResponse(s,{status:200,headers:{"Content-Type":"application/xml","Cache-Control":"public, s-maxage=300, stale-while-revalidate=600","Access-Control-Allow-Origin":"*"}})}let o=r.startsWith("http")?r:`${l}/${r}`;console.log(`[S3 Proxy] Fetching file: ${o}`);let a=await fetch(o,{method:"GET",headers:{Accept:"application/json","User-Agent":"Coefly-App/1.0"},next:{revalidate:300}});if(!a.ok){if(404===a.status)return i.NextResponse.json({error:"File not found"},{status:404});return console.error(`[S3 Proxy] Fetch failed: ${a.status} ${a.statusText}`),i.NextResponse.json({error:`S3 request failed: ${a.statusText}`},{status:a.status})}let n=await a.json();return i.NextResponse.json(n,{status:200,headers:{"Cache-Control":"public, s-maxage=300, stale-while-revalidate=600","Access-Control-Allow-Origin":"*"}})}catch(e){return console.error("[S3 Proxy] Error:",e),i.NextResponse.json({error:"Internal proxy error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function c(){return new i.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/s3-proxy/route",pathname:"/api/s3-proxy",filename:"route",bundlePath:"app/api/s3-proxy/route"},resolvedPagePath:"/Users/romanvasilev/true-coef-site/src/app/api/s3-proxy/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:f}=d,g="/api/s3-proxy/route";function y(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[424,965],()=>r(8796));module.exports=s})();
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{2067:e=>{"use strict";e.exports=require("node:async_hooks")},6195:e=>{"use strict";e.exports=require("node:buffer")},799:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ComponentMod:()=>C,default:()=>m});var s={};r.r(s),r.d(s,{GET:()=>x,OPTIONS:()=>h,revalidate:()=>d,runtime:()=>p});var o={};r.r(o),r.d(o,{originalPathname:()=>A,patchFetch:()=>k,requestAsyncStorage:()=>y,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g});var a=r(0),n=r(1209),i=r(4934),l=r(55),u=r(1388);let c="https://storage.yandexcloud.net/screen-shared",p="edge",d=300;async function x(e){try{let{searchParams:t}=new URL(e.url),r=t.get("path"),s=t.get("action");if(!r)return u.xk.json({error:"Missing path parameter"},{status:400});if("list"===s){let e=`${c}/?list-type=2&prefix=${encodeURIComponent(r)}`;console.log(`[S3 Proxy] Listing files: ${e}`);let t=await fetch(e,{method:"GET",headers:{Accept:"application/xml","User-Agent":"Coefly-App/1.0"},cache:"no-store"});if(!t.ok)return console.error(`[S3 Proxy] List failed: ${t.status} ${t.statusText}`),u.xk.json({error:`S3 request failed: ${t.statusText}`},{status:t.status});let s=await t.text();return new u.xk(s,{status:200,headers:{"Content-Type":"application/xml","Cache-Control":"public, s-maxage=300, stale-while-revalidate=600","Access-Control-Allow-Origin":"*"}})}let o=r.startsWith("http")?r:`${c}/${r}`;console.log(`[S3 Proxy] Fetching file: ${o}`);let a=await fetch(o,{method:"GET",headers:{Accept:"application/json","User-Agent":"Coefly-App/1.0"},next:{revalidate:300}});if(!a.ok){if(404===a.status)return u.xk.json({error:"File not found"},{status:404});return console.error(`[S3 Proxy] Fetch failed: ${a.status} ${a.statusText}`),u.xk.json({error:`S3 request failed: ${a.statusText}`},{status:a.status})}let n=await a.json();return u.xk.json(n,{status:200,headers:{"Cache-Control":"public, s-maxage=300, stale-while-revalidate=600","Access-Control-Allow-Origin":"*"}})}catch(e){return console.error("[S3 Proxy] Error:",e),u.xk.json({error:"Internal proxy error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function h(){return new u.xk(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let f=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/s3-proxy/route",pathname:"/api/s3-proxy",filename:"route",bundlePath:"app/api/s3-proxy/route"},resolvedPagePath:"/Users/romanvasilev/true-coef-site/src/app/api/s3-proxy/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:w}=f,A="/api/s3-proxy/route";function k(){return(0,l.XH)({serverHooks:w,staticGenerationAsyncStorage:g})}let C=o,m=a.a.wrap(f)}},e=>{var t=t=>e(e.s=t);e.O(0,[740],()=>t(799));var r=e.O();(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/s3-proxy/route"]=r}]);
//# sourceMappingURL=route.js.map